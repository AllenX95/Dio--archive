# 片上网络 vs 数据中心网络

> **类型**: 文章
> **作者**: Dio-晶
> **赞同**: 248
> **评论**: 10
> **时间**: 1605448175
> **原文**: [https://zhuanlan.zhihu.com/p/295368691](https://zhuanlan.zhihu.com/p/295368691)

---

作为处理器片上网络（俗称NOC）大中华区的技术第一人吧（这点自信还是要有），最近因为多种机缘参与了多次混合数据中心网络和NOC的技术讨论。站在对NOC的视角看数据中心网络，理解了一下数据中心网络的立场再回头看NOC，感觉真是很奇妙，虽然都是networking，但却感觉上既亲密又陌生。

我其实也没有很深刻的理解，但是感受到了一点两者之间的融合和矛盾，只是权做记录吧。

数据中心网络其实是处于一个很尴尬的立场，从协议上讲，它采用的是Ethernet互联，因为没有骨干网或者核心网的存在（不大不小），所以整个交换的底座是不可靠、无连接为基本面的IP交换。为了提高交换效率不得不搞出RDMA这么个可靠又带连接的协议，因为要把原本loosy的网络改造成lossless惹出各种各样的烦恼。当然让RDMA变成支持loosy是一种方法，另一种方法是直接把数据中心网络底层就改造成lossless，如果再补充上乱序、多路径。这种改造的过程就会让人突然感到有一点点变得像NOC的技术领域了。

题外话: 简单定义某种私有互联解决数据中心网络不是不可以，但数据中心南北向流量是必须依赖传统Ethernet接入的，如果不能妥善解决IP over私有XXX的问题，就得布置两张独立网络，根本不可能。用infiniband做数据中心互联其实是个好方案还支持ipoib，不过规模限制和价格成为极大的障碍。

除开数据中心，做NOC本身也在逐渐地扩展其规模，片上的互联一直妄图向上去吃掉一部分数据中心网络。典型的就是wafer scale，其实如果一个wafer不切割直接做成一个脸盆大的芯片。不考虑散热供电的话，一个12寸晶圆级别大约6Wmm2面积大VLSI，这应该就是人类当前芯片技术可见空间的极大值了，也应该是人类芯片设计者共有的梦想。芯片到这个级别，其实就相当于传统CPU领域大约100倍左右的集成度提升，也相当于数据中心传统机架的100倍微缩，此时的NOC又需要反过来去表征一个数据中心的小集群了。

传统数据中心网络是一个超高纬度互联，典型的fatTree是依赖于在三维空间中线缆的长短跨接形成的高纬度互联形态，只要topology允许，你可以用一根足够长的光纤将任意两个设备连起来。正是因为能够超纬，所以数据中心交换机（router）都是超多端口和总交换带宽，这种高纬聚合结果是: **任意节点对通常最多只需要五跳就能到达，任意对称平面切割后流量大概率不聚合（即切割面总流量等于两侧均匀交换流量之和）。**

NOC如果不考虑还未突破的3DIC和硅光交换，片上互联的topology必须是2D的（跨router直连不是不行，但比起逐router级联带宽会损失一个数量级，得不偿失），所以router固定只有4个交换端口X+、X-、Y+、Y-。这种低纬度互联的结果是: **任意节点对可能需要数十个router jump才能到达，而基于某个平面切割的话，切割面越靠近边缘带宽越低，越靠近中间流量越高，即中央拥塞（cmesh是一个奇葩但实际难以实现）。**

这两个主要的差异造成了NOC的架构师与数据中心网络架构师相遇时相互之间理念的差异。

**典型来讲:**

1、源路由策略在数据中心短步径下更靠谱，但分布式路由则在巨型NOC网络更适用。

2、传统数据中心stream类传输偏多，基于stream的stateful源头拥塞管理机制也更适用，而NOC内one shot类传输偏多（GPU除外），基于无序的stateless分布式拥塞管理则在大型NOC网络更适用。

3、数据中心fattree的流量是不聚合的，因此无论是all reduce或是ring reduce，都能平滑适配。NOC作为2D互联天生存在流量聚合，任意区域均匀交换必然导致区域中央拥塞，不均匀交换（访问内存）则问题更大（当然某种说法是NOC即使跨DIE也是Tbps级别，收敛影响比较小），互联规模大之后必须要某种类似ring reduce机制解决带宽聚合问题。

4、传统数据中心lossy网络是不太考虑环路deadlock的，毕竟可丢包，而且往往依赖超纬互联形成TREE（无环），但如果要做多路径，loop path无法避免。而NOC是lossless，天生2D平面存loop path不可避免，需要花费巨量的精力去避免deadlock。

5、传统数据中心会必须假定任意node都可以故障但不扩散（挂掉一个数据中心会fire一批人的），而NOC往往则不会假定有故障在运行过程中发生（初始可以设定）。

**坦白来讲，以我目前的见识，这些矛盾当前在两个架构师之间很难很难妥协。**

![](../images/a2d19d3354c25a7ffe374761694d0546.gif)![](data:image/svg+xml;utf8,<svg%20xmlns='http://www.w3.org/2000/svg'%20width='200'%20height='140'></svg>)

**但是！**

如我前面所讲，数据中心网络很大趋势需要向着lossless、乱序多路径演进提升效率，而NOC也会基于wafer scale向上数据中心的小集群规模扩展。

**技术的演进就如潮水一般永不停止，是难题，亦是机会。**

![](../images/70536b551de17fa60e4c5070284d5dd8.jpg)![](../images/70536b551de17fa60e4c5070284d5dd8.jpg)

---

*由知乎爬虫生成于 2026-02-01 15:39:01*
